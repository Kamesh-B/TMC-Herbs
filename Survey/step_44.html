<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Building Your Relief Plan</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --pink:#e75480; --pink-2:#ff8fb0; --pink-light:#ffe6ec;
      --border:#EDEDF2; --text:#212124; --muted:#6D6E71; --bg:#ffffff;
    }
    html{line-height:1.15;-webkit-text-size-adjust:100%}
    body{margin:0;font-family:'Manrope',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text)}
    *,:before,:after{box-sizing:border-box;border:0 solid var(--border)}
    html,body{height:100%}

    #__next{display:flex;flex-direction:column;max-width:560px;margin:0 auto;min-height:100%;background:#fff}
    header{padding:28px 22px 10px;text-align:center}
    .title{font-size:28px;font-weight:800;line-height:1.15;margin:0}
    .sub{font-size:14px;color:var(--muted);margin-top:6px}

    main{flex:1 1 auto;padding:10px 18px 24px}
    .stage{border:1px solid var(--border);border-radius:16px;padding:14px 14px 12px;margin-bottom:14px;background:#fff;box-shadow:0 1px 0 rgba(0,0,0,.03)}
    .row{display:flex;align-items:center;gap:10px;margin-bottom:8px}
    .num{flex:0 0 28px;height:28px;border-radius:999px;display:grid;place-items:center;font-weight:800;font-size:14px;color:#fff;background:linear-gradient(90deg,var(--pink),var(--pink-2))}
    .num.done{background:linear-gradient(90deg,#42c97a,#7be3a2)}
    .check{font-size:14px}
    .label{font-weight:800}
    .pct{margin-left:auto;font-weight:700;color:#6e7080;font-size:13px;min-width:40px;text-align:right}

    .bar-wrap{height:8px;border-radius:9999px;background:#f1f2f6;overflow:hidden;box-shadow:inset 0 1px 0 rgba(0,0,0,.04)}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--pink),var(--pink-2));border-radius:inherit;box-shadow:0 1px 2px rgba(231,84,128,.25)}
    .desc{font-size:13px;color:#7c7e85;margin-top:8px}

    footer{padding:14px;border-top:1px solid var(--border);text-align:center;font-size:12px;color:var(--muted)}
    .hl{background:linear-gradient(180deg,rgba(231,84,128,.12),rgba(231,84,128,.12));border-radius:6px;padding:0 4px}
  </style>
</head>
<body>
  <div id="__next">
    <header>
      <h1 class="title">Building Your <span id="problem" class="hl">Relief</span> Plan</h1>
      <p class="sub">Hang tight while we prepare everything for you…</p>
    </header>

    <main aria-live="polite">
      <!-- 1 -->
      <section class="stage" id="s1">
        <div class="row">
          <div class="num" id="n1">1</div>
          <div class="label">Analyzing Your Symptoms</div>
          <div class="pct" id="p1">0%</div>
        </div>
        <div class="bar-wrap"><div class="bar" id="b1"></div></div>
        <p class="desc">Reviewing what you shared to spot patterns.</p>
      </section>

      <!-- 2 -->
      <section class="stage" id="s2">
        <div class="row">
          <div class="num" id="n2">2</div>
          <div class="label">Identifying Root Causes</div>
          <div class="pct" id="p2">0%</div>
        </div>
        <div class="bar-wrap"><div class="bar" id="b2"></div></div>
        <p class="desc">Mapping symptoms to likely hormonal/organ imbalances.</p>
      </section>

      <!-- 3 -->
      <section class="stage" id="s3">
        <div class="row">
          <div class="num" id="n3">3</div>
          <div class="label">Formulating Herbal Recommendations</div>
          <div class="pct" id="p3">0%</div>
        </div>
        <div class="bar-wrap"><div class="bar" id="b3"></div></div>
        <p class="desc">Selecting classical formulas and modern adaptations.</p>
      </section>

      <!-- 4 -->
      <section class="stage" id="s4">
        <div class="row">
          <div class="num" id="n4">4</div>
          <div class="label">Aligning Daily Habits + Diet</div>
          <div class="pct" id="p4">0%</div>
        </div>
        <div class="bar-wrap"><div class="bar" id="b4"></div></div>
        <p class="desc">Tuning lifestyle tips that support faster relief.</p>
      </section>

      <!-- 5 -->
      <section class="stage" id="s5">
        <div class="row">
          <div class="num" id="n5">5</div>
          <div class="label">Preparing Your Custom Plan</div>
          <div class="pct" id="p5">0%</div>
        </div>
        <div class="bar-wrap"><div class="bar" id="b5"></div></div>
        <p class="desc">Packaging your step-by-step results.</p>
      </section>
    </main>

    <footer>This should take about 13–17 seconds…</footer>
  </div>

  <script>
  (function(){
    // ----- Config -----
    const TOTAL_MS = 17000;                  // ~11 seconds total
    const STEPS = 5;
    const PER_STEP = TOTAL_MS / STEPS;       // ~2.2s each
    const NEXT_PAGE = 'step_45.html';

    // ----- Session & {Problem} label -----
    const KEY = 'menopause-quiz';
    const SID_KEY = 'quiz_session_id';
    const params = new URLSearchParams(location.search);

    let sid = localStorage.getItem(SID_KEY);
    if (!sid) {
      sid = (crypto.randomUUID
        ? crypto.randomUUID()
        : ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
            (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
          ));
      localStorage.setItem(SID_KEY, sid);
    }
    if (!params.get('sid')) params.set('sid', sid);

    let answers = {};
    try { answers = JSON.parse(localStorage.getItem(KEY)) || {}; } catch {}

    const raw = (params.get('stage') || answers.stage || '').toString().toLowerCase();
    function problemLabel(s){
      if (s.includes('peri')) return 'Perimenopause';
      if (s.includes('post')) return 'Postmenopause';
      if (s.includes('pre'))  return 'Pre-menopause';
      if (s.includes('meno')) return 'Menopause';
      return 'Hormone';
    }
    document.getElementById('problem').textContent = `${problemLabel(raw)} Relief`;

    // ----- Progress Engine -----
    const bars = [1,2,3,4,5].map(i => ({
      bar: document.getElementById('b'+i),
      pct: document.getElementById('p'+i),
      num: document.getElementById('n'+i)
    }));

    let stepIndex = 0;
    function animateStep(i){
      const {bar, pct, num} = bars[i];
      const start = performance.now();
      function tick(now){
        const p = Math.min(1, (now - start) / PER_STEP);
        const w = Math.round(p * 100);
        bar.style.width = w + '%';
        pct.textContent = w + '%';
        if (p < 1) requestAnimationFrame(tick);
        else {
          // mark done
          num.classList.add('done');
          num.textContent = '✓';
          stepIndex++;
          if (stepIndex < STEPS) animateStep(stepIndex);
          else setTimeout(()=>{ location.href = `${NEXT_PAGE}?${params.toString()}`; }, 250);
        }
      }
      requestAnimationFrame(tick);
    }
    animateStep(0);

    // Reduced motion: finish fast
    if (matchMedia('(prefers-reduced-motion: reduce)').matches) {
      bars.forEach(b=>{ b.bar.style.width='100%'; b.pct.textContent='100%'; b.num.classList.add('done'); b.num.textContent='✓'; });
      setTimeout(()=>{ location.href = `${NEXT_PAGE}?${params.toString()}`; }, 400);
    }
  })();
  </script>
</body>
</html>
